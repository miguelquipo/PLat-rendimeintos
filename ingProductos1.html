<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CV - Ingreso Productos</title>
  <link rel="stylesheet" href="./CSS/stylesInsertPrd.css">
  <link rel="icon" href="./A-IMG/logo_prueba.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="./CSS/bootstrap-table.min.css">
  <link rel="stylesheet" href="./CSS/bootstrap.min.css">
</head>
<body>
  <img src="./A-IMG/logo_prueba.png" alt="Logo de la empresa" class="logo">
    
  <div class="menu">
    <!-- Resto de los botones aquí -->
  </div>
  <div class="return-container">
    <a href="index.html" class="return-button"> <!-- Enlace a la página anterior -->
      <i class="fas fa-arrow-left"></i>
    </a>
  </div>

  <div class="container">
    <h1>Ingreso Productos</h1>
    <form id="crud-form" method="post" action="./PHP/ingresoProd.php">
      <div class="form-group">
        <label for="product-name">Nombre del Producto</label>
        <input type="text" id="product-name" name="product-name" placeholder="" required>
      </div>
      <div class="form-group">
        <label for="product-rendimiento-hora">Rendimiento Hora</label>
        <input type="text" id="product-rendimiento-hora" name="product-rendimiento-hora" placeholder="" required>
      </div>
      <button type="submit">Agregar Producto</button>
    </form>
  </div>

  <!-- Tabla -->
  <div class="table-container">
    <h2>Cultiverde Productos</h2>
    <table id="productos-table"
    data-height="600"
    data-toggle="productos-table"
    data-toolbar=".toolbar"
    class="table table-striped table-sm">
      <thead>
        <tr>
          <th>ID</th>
          <th data-searchable="true">Nombre Producto</th>
          <th data-searchable="true">Producto Hora</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <!-- Aquí se llenará la tabla con los datos -->
      </tbody>
    </table>
    <button id="exportar-btn">Exportar a Excel</button>
  </div>

 <script src="./SCRIPTS/jquery-3.7.1.min.js"></script>
  <script src="./SCRIPTS/bootstrap.bundle.min.js"></script>
  <script src="./SCRIPTS/bootstrap-table.min.js"></script>
  <script src="./SCRIPTS/bootstrap-table.js"></script>
  <script src="./SCRIPTS/bootstrap-table-es-MX.min.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    obtenerDatos();

    const exportarBtn = document.getElementById('exportar-btn');
    exportarBtn.addEventListener('click', function() {
        exportarExcel('table-body');
    });
});

function obtenerDatos() {
    fetch('./PHP/obtener_productos.php')
        .then(response => response.json())
        .then(data => {
            mostrarDatosEnTabla(data);
            inicializarTabla();
        })
        .catch(error => {
            console.error('Error al obtener los datos:', error);
        });
}

// En el bloque de script JavaScript
function mostrarDatosEnTabla(data) {
    const tableBody = document.getElementById('table-body');
    tableBody.innerHTML = '';

    data.forEach(producto => {
        const row = document.createElement('tr');
        row.innerHTML = `
        <td>${producto.id_producto}</td>
        <td id="nombre-producto-${producto.id_producto}">${producto.nombre_producto}</td>
        <td id="rendimiento-producto-hora-${producto.id_producto}">${producto.rendimiento_producto_hora}</td>
        <td>
          <div class="container-fluid btn-group" role="group">
              <button class="btn btn-success" onclick="redirigirFormulario('${producto.id_producto}')">
                  <i class="fa-solid fa-arrows-rotate"></i>
              </button>
          </div>
        </td>
        `;
        tableBody.appendChild(row);
    });
}

function redirigirFormulario(id_producto) {
    // Obtener los datos del producto
    const nombre_producto = document.getElementById(`nombre-producto-${id_producto}`).innerText;
    const rendimiento_producto_hora = document.getElementById(`rendimiento-producto-hora-${id_producto}`).innerText;

    // Asignar los valores al formulario de ingreso de productos
    document.getElementById('product-name').value = nombre_producto;
    document.getElementById('product-rendimiento-hora').value = rendimiento_producto_hora;

    // Mostrar el formulario modal
    $('#crud-form-modal').modal('show');

    // Evitar la actualización automática de la página
    return false;
}


function inicializarTabla() {
    $('#productos-table').bootstrapTable({
        search: true, // Habilitar la función de búsqueda
        columns: [{
            field: 'id_producto',
            title: 'ID'
        }, {
            field: 'nombre_producto',
            title: 'Nombre Producto'
        }, {
            field: 'rendimiento_producto_hora',
            title: 'Producto Hora'
        }]
    });
}

function exportarExcel() {
    const ws = XLSX.utils.table_to_sheet(document.getElementById('productos-table'));
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Productos');
    XLSX.writeFile(wb, 'Productos.xlsx');
}


  </script>
  
</body>
</html>
